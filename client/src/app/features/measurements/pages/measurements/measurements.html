<app-base-list
  [config]="measurementListConfig"
  [emptyMessage]="'measurements.no_measurements_found'"
  [error]="error()"
  [hasItems]="hasMeasurements()"
  [loading]="loading()"
  [paginationSource]="pagination()"
  (addClicked)="openCreateModal()"
>
  <div table>
    <table class="table table-hover mb-0">
      <thead>
        <tr>
          <th>{{ 'misc.date' | translate }}</th>
          <th class="text-end">{{ 'measurements.weight' | translate }} (kg)</th>
          <th class="text-end d-none d-md-table-cell">
            {{ 'measurements.height' | translate }} (cm)
          </th>
          <th class="text-end d-none d-lg-table-cell">{{ 'measurements.steps' | translate }}</th>
          <th class="text-end d-none d-xl-table-cell">{{ 'measurements.ftp' | translate }} (W)</th>
          <th class="text-end d-none d-xl-table-cell">
            {{ 'measurements.resting_hr' | translate }} (bpm)
          </th>
          <th class="text-end d-none d-xl-table-cell">
            {{ 'measurements.max_hr' | translate }} (bpm)
          </th>
          <th class="text-center">{{ 'misc.actions' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        @for (measurement of measurements(); track measurement.id) {
          <tr>
            <td>
              <strong>{{ formatDate(measurement.date) }}</strong>
            </td>
            <td class="text-end">
              @if (measurement.weight) {
                {{ measurement.weight.toFixed(1) }}
              } @else {
                <span class="text-muted">-</span>
              }
            </td>
            <td class="text-end d-none d-md-table-cell">
              @if (measurement.height) {
                {{ measurement.height.toFixed(1) }}
              } @else {
                <span class="text-muted">-</span>
              }
            </td>
            <td class="text-end d-none d-lg-table-cell">
              @if (measurement.steps) {
                {{ measurement.steps.toLocaleString() }}
              } @else {
                <span class="text-muted">-</span>
              }
            </td>
            <td class="text-end d-none d-xl-table-cell">
              @if (measurement.ftp) {
                {{ measurement.ftp.toFixed(0) }}
              } @else {
                <span class="text-muted">-</span>
              }
            </td>
            <td class="text-end d-none d-xl-table-cell">
              @if (measurement.resting_heart_rate) {
                {{ measurement.resting_heart_rate.toFixed(0) }}
              } @else {
                <span class="text-muted">-</span>
              }
            </td>
            <td class="text-end d-none d-xl-table-cell">
              @if (measurement.max_heart_rate) {
                {{ measurement.max_heart_rate.toFixed(0) }}
              } @else {
                <span class="text-muted">-</span>
              }
            </td>
            <td class="text-center">
              <div class="btn-group btn-group-sm" role="group">
                <button
                  class="btn btn-outline-secondary"
                  [attr.title]="'misc.edit' | translate"
                  (click)="openEditModal(measurement)"
                >
                  <app-icon name="edit" size="16" />
                </button>
                <button
                  class="btn btn-outline-danger"
                  [attr.title]="'misc.delete' | translate"
                  (click)="openDeleteModal(measurement)"
                >
                  <app-icon name="delete" size="16" />
                </button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</app-base-list>

<!-- Create Modal -->
@if (showCreateModal()) {
  <div class="modal fade show d-block" style="background-color: rgba(0, 0, 0, 0.5)" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ 'measurements.add_measurement' | translate }}</h5>
          <button
            aria-label="Close"
            class="btn-close"
            type="button"
            (click)="closeCreateModal()"
          ></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label" for="create-date">{{ 'misc.date' | translate }}</label>
            <input
              class="form-control"
              id="create-date"
              type="date"
              [value]="measurementForm().date"
              (input)="updateFormDate($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="create-weight"
              >{{ 'measurements.weight' | translate }} (kg)</label
            >
            <input
              class="form-control"
              id="create-weight"
              step="0.1"
              type="number"
              [value]="measurementForm().weight || ''"
              (input)="updateFormWeight($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="create-height"
              >{{ 'measurements.height' | translate }} (cm)</label
            >
            <input
              class="form-control"
              id="create-height"
              step="0.1"
              type="number"
              [value]="measurementForm().height || ''"
              (input)="updateFormHeight($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="create-steps">{{
              'measurements.steps' | translate
            }}</label>
            <input
              class="form-control"
              id="create-steps"
              type="number"
              [value]="measurementForm().steps || ''"
              (input)="updateFormSteps($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="create-ftp">
              {{ 'measurements.ftp' | translate }} (W)
            </label>
            <input
              class="form-control"
              id="create-ftp"
              step="1"
              type="number"
              [value]="measurementForm().ftp || ''"
              (input)="updateFormFTP($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="create-rhr">
              {{ 'measurements.resting_hr' | translate }} (bpm)
            </label>
            <input
              class="form-control"
              id="create-rhr"
              step="1"
              type="number"
              [value]="measurementForm().resting_heart_rate || ''"
              (input)="updateFormRestingHeartRate($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="create-mhr">
              {{ 'measurements.max_hr' | translate }} (bpm)
            </label>
            <input
              class="form-control"
              id="create-mhr"
              step="1"
              type="number"
              [value]="measurementForm().max_heart_rate || ''"
              (input)="updateFormMaxHeartRate($any($event.target).value)"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="closeCreateModal()">
            {{ 'misc.cancel' | translate }}
          </button>
          <button class="btn btn-primary" type="button" (click)="createMeasurement()">
            {{ 'misc.create' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Edit Modal -->
@if (showEditModal()) {
  <div class="modal fade show d-block" style="background-color: rgba(0, 0, 0, 0.5)" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ 'measurements.update_measurement' | translate }}</h5>
          <button
            aria-label="Close"
            class="btn-close"
            type="button"
            (click)="closeEditModal()"
          ></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label" for="edit-date">{{ 'misc.date' | translate }}</label>
            <input
              class="form-control"
              id="edit-date"
              type="date"
              [value]="measurementForm().date"
              (input)="updateFormDate($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="edit-weight"
              >{{ 'measurements.weight' | translate }} (kg)</label
            >
            <input
              class="form-control"
              id="edit-weight"
              step="0.1"
              type="number"
              [value]="measurementForm().weight || ''"
              (input)="updateFormWeight($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="edit-height"
              >{{ 'measurements.height' | translate }} (cm)</label
            >
            <input
              class="form-control"
              id="edit-height"
              step="0.1"
              type="number"
              [value]="measurementForm().height || ''"
              (input)="updateFormHeight($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="edit-steps">{{ 'measurements.steps' | translate }}</label>
            <input
              class="form-control"
              id="edit-steps"
              type="number"
              [value]="measurementForm().steps || ''"
              (input)="updateFormSteps($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="edit-ftp">
              {{ 'measurements.ftp' | translate }} (W)
            </label>
            <input
              class="form-control"
              id="edit-ftp"
              step="1"
              type="number"
              [value]="measurementForm().ftp || ''"
              (input)="updateFormFTP($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="edit-rhr">
              {{ 'measurements.resting_hr' | translate }} (bpm)
            </label>
            <input
              class="form-control"
              id="edit-rhr"
              step="1"
              type="number"
              [value]="measurementForm().resting_heart_rate || ''"
              (input)="updateFormRestingHeartRate($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="edit-mhr">
              {{ 'measurements.max_hr' | translate }} (bpm)
            </label>
            <input
              class="form-control"
              id="edit-mhr"
              step="1"
              type="number"
              [value]="measurementForm().max_heart_rate || ''"
              (input)="updateFormMaxHeartRate($any($event.target).value)"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="closeEditModal()">
            {{ 'misc.cancel' | translate }}
          </button>
          <button class="btn btn-primary" type="button" (click)="updateMeasurement()">
            {{ 'misc.update' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Delete Modal -->
@if (showDeleteModal() && selectedMeasurement()) {
  <div class="modal fade show d-block" style="background-color: rgba(0, 0, 0, 0.5)" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ 'misc.delete' | translate }}</h5>
          <button
            aria-label="Close"
            class="btn-close"
            type="button"
            (click)="closeDeleteModal()"
          ></button>
        </div>
        <div class="modal-body">
          <p>{{ 'misc.are_you_sure' | translate }}</p>
          <p>
            <strong>{{ formatDate(selectedMeasurement()!.date) }}</strong>
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="closeDeleteModal()">
            {{ 'misc.cancel' | translate }}
          </button>
          <button class="btn btn-danger" type="button" (click)="deleteMeasurement()">
            {{ 'misc.delete' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
}
