<div class="container my-5" style="max-width: 800px">
  @if (error()) {
    <div class="alert alert-danger" role="alert">
      {{ error() }}
    </div>
  }

  @if (successMessage()) {
    <div class="alert alert-success" role="alert">
      {{ successMessage() }}
    </div>
  }

  @if (loading()) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">{{ 'misc.loading' | translate }}</span>
      </div>
    </div>
  } @else if (profile()) {
    <!-- User Settings Section -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h3 class="card-title h5 mb-3 d-flex align-items-center gap-2">
          <app-icon name="person" size="24" />
          {{ 'user.profile.your_settings' | translate }}
        </h3>

        <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
          <!-- API Access -->
          <div class="mb-3 pb-3 border-bottom">
            <div class="form-check">
              <input
                class="form-check-input"
                formControlName="api_active"
                id="api_active"
                type="checkbox"
              />
              <label class="form-check-label" for="api_active">
                {{ 'user.profile.enable_api_access' | translate }}
                <a
                  class="link-primary ms-1"
                  href="https://github.com/jovandeginste/workout-tracker?tab=readme-ov-file#api-usage"
                  target="_blank"
                >
                  <app-icon name="info" size="16" />
                </a>
              </label>
            </div>
            @if (profileForm.value.api_active && profile() && profile()!.profile.api_key) {
              <div class="mt-2 d-flex align-items-center gap-2">
                <input
                  class="form-control form-control-sm"
                  readonly
                  [type]="apiKeyVisible() ? 'text' : 'password'"
                  [value]="profile()!.profile.api_key!"
                />
                <button
                  class="btn btn-sm btn-outline-secondary"
                  type="button"
                  [title]="'user.profile.show_hide' | translate"
                  (click)="toggleAPIKeyVisibility()"
                >
                  <app-icon size="20" [name]="apiKeyVisible() ? 'visibility-off' : 'visibility'" />
                </button>
                <button
                  class="btn btn-sm btn-outline-secondary"
                  type="button"
                  [title]="'user.profile.copy_to_clipboard' | translate"
                  (click)="copyToClipboard(profile()!.profile.api_key!)"
                >
                  <app-icon name="content-copy" size="20" />
                </button>
                <button
                  class="btn btn-sm btn-outline-danger"
                  type="button"
                  [title]="'user.profile.generate_a_new_api_key' | translate"
                  (click)="resetAPIKey()"
                >
                  <app-icon name="refresh" size="20" />
                </button>
              </div>
            }
          </div>

          <!-- Totals Show -->
          <div class="mb-3">
            <label class="form-label" for="totals_show">
              {{ 'user.profile.totals_to_show_on_dashboard' | translate }}
            </label>
            <select class="form-select" formControlName="totals_show" id="totals_show">
              <option value="all">{{ 'filters.all' | translate }}</option>
              <option value="running">{{ 'sports.running' | translate }}</option>
              <option value="cycling">{{ 'sports.cycling' | translate }}</option>
              <option value="walking">{{ 'sports.walking' | translate }}</option>
            </select>
          </div>

          <!-- Timezone -->
          <div class="mb-3">
            <label class="form-label" for="timezone">
              {{ 'user.profile.time_zone' | translate }}
            </label>
            <input
              class="form-control"
              formControlName="timezone"
              id="timezone"
              placeholder="UTC"
              type="text"
            />
          </div>

          <!-- Birthdate -->
          <div class="mb-3">
            <label class="form-label" for="birthdate">
              {{ 'user.profile.birthdate' | translate }}
              <small class="text-muted">{{ 'user.profile.birthdate_hint' | translate }}</small>
            </label>
            <input
              class="form-control"
              formControlName="birthdate"
              id="birthdate"
              type="date"
            />
          </div>

          <!-- Language -->
          <div class="mb-3">
            <label class="form-label" for="language">
              {{ 'user.profile.language' | translate }}
              <a
                class="link-primary ms-1"
                href="https://hosted.weblate.org/projects/workout-tracker/"
                target="_blank"
                [title]="'user.profile.weblate_help' | translate"
              >
                <app-icon name="translate" size="16" />
              </a>
            </label>
            <select class="form-select" formControlName="language" id="language">
              <option value="browser">{{ 'languages.browser' | translate }}</option>
              <option value="en">{{ 'languages.english' | translate }}</option>
              <option value="de">{{ 'languages.german' | translate }}</option>
              <option value="fr">{{ 'languages.french' | translate }}</option>
            </select>
          </div>

          <!-- Theme -->
          <div class="mb-3">
            <label class="form-label" for="theme"> {{ 'user.profile.theme' | translate }} </label>
            <select class="form-select" formControlName="theme" id="theme">
              <option value="light">{{ 'user.profile.light' | translate }}</option>
              <option value="dark">{{ 'user.profile.dark' | translate }}</option>
              <option value="browser">{{ 'user.profile.browser_system' | translate }}</option>
            </select>
          </div>

          <!-- Auto Import Directory -->
          <div class="mb-3">
            <label class="form-label" for="auto_import_directory">
              {{ 'user.profile.auto_import_directory' | translate }}
            </label>
            <input
              class="form-control"
              formControlName="auto_import_directory"
              id="auto_import_directory"
              type="text"
              [placeholder]="'/imports/' + profile()!.username + '/'"
            />
          </div>

          <!-- Prefer Full Date -->
          <div class="mb-3 form-check">
            <input
              class="form-check-input"
              formControlName="prefer_full_date"
              id="prefer_full_date"
              type="checkbox"
            />
            <label class="form-check-label" for="prefer_full_date">
              {{ 'user.profile.show_full_date_by_default' | translate }}
            </label>
          </div>

          <!-- Disable Social Sharing Buttons -->
          <div class="mb-3 form-check">
            <input
              class="form-check-input"
              formControlName="socials_disabled"
              id="socials_disabled"
              type="checkbox"
            />
            <label class="form-check-label" for="socials_disabled">
              {{ 'user.profile.disable_social_sharing_buttons' | translate }}
            </label>
          </div>

          <!-- Save Button -->
          <div class="pt-3">
            <button
              class="btn btn-primary"
              type="submit"
              [disabled]="saving() || profileForm.invalid"
            >
              @if (saving()) {
                <span
                  aria-hidden="true"
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                ></span>
                {{ 'user.profile.saving' | translate }}
              } @else {
                {{ 'user.profile.update_profile' | translate }}
              }
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Preferred Units Section -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h3 class="card-title h5 mb-3 d-flex align-items-center gap-2">
          <app-icon name="straighten" size="24" />
          {{ 'user.profile.preferred_units' | translate }}
        </h3>

        <div [formGroup]="profileForm">
          <div class="row g-3" formGroupName="preferred_units">
            <!-- Speed -->
            <div class="col-md-6">
              <label class="form-label" for="speed"> {{ 'user.profile.speed' | translate }} </label>
              <select class="form-select" formControlName="speed" id="speed">
                <option value="km/h">{{ 'units.kilometers_per_hour_short' | translate }}</option>
                <option value="mph">{{ 'units.miles_per_hour_short' | translate }}</option>
              </select>
            </div>

            <!-- Distance -->
            <div class="col-md-6">
              <label class="form-label" for="distance">
                {{ 'user.profile.distance' | translate }}
              </label>
              <select class="form-select" formControlName="distance" id="distance">
                <option value="km">{{ 'units.kilometers_short' | translate }}</option>
                <option value="mi">{{ 'units.miles_short' | translate }}</option>
              </select>
            </div>

            <!-- Elevation -->
            <div class="col-md-6">
              <label class="form-label" for="elevation">
                {{ 'user.profile.elevation' | translate }}
              </label>
              <select class="form-select" formControlName="elevation" id="elevation">
                <option value="m">{{ 'units.meters_short' | translate }}</option>
                <option value="ft">{{ 'units.feet_short' | translate }}</option>
              </select>
            </div>

            <!-- Weight -->
            <div class="col-md-6">
              <label class="form-label" for="weight"> {{ 'user.profile.weight' | translate }} </label>
              <select class="form-select" formControlName="weight" id="weight">
                <option value="kg">{{ 'units.kilograms_short' | translate }}</option>
                <option value="lbs">{{ 'units.pounds_short' | translate }}</option>
              </select>
            </div>

            <!-- Height -->
            <div class="col-md-6">
              <label class="form-label" for="height"> {{ 'user.profile.height' | translate }} </label>
              <select class="form-select" formControlName="height" id="height">
                <option value="cm">{{ 'units.centimeters_short' | translate }}</option>
                <option value="in">{{ 'units.inches_short' | translate }}</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions Section -->
    <div class="card shadow-sm">
      <div class="card-body">
        <h3 class="card-title h5 mb-3 d-flex align-items-center gap-2">
          <app-icon name="bolt" size="24" />
          {{ 'misc.actions' | translate }}
        </h3>

        <div
          class="d-flex align-items-center justify-content-between p-3 bg-body-secondary rounded"
        >
          <div>
            <div class="fw-medium">{{ 'user.profile.refresh_all_your_workouts' | translate }}</div>
            <p class="small text-muted mb-0">
              {{ 'user.profile.refresh_workouts_help' | translate }}
            </p>
          </div>
          <button
            class="btn btn-primary d-flex align-items-center gap-2"
            type="button"
            (click)="refreshWorkouts()"
          >
            <app-icon name="refresh" size="20" />
            {{ 'misc.refresh' | translate }}
          </button>
        </div>
      </div>
    </div>
  }
</div>
