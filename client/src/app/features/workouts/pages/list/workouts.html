<app-base-list
  [config]="listConfig"
  [emptyMessage]="'No items found'"
  [error]="error()"
  [hasItems]="hasWorkouts()"
  [loading]="loading()"
  [paginationSource]="pagination()"
  (addClicked)="onAddWorkout()"
>
  <!-- Bulk actions when items are selected -->
  <div bulkActions class="d-flex gap-2">
    <button
      class="btn btn-sm btn-outline-danger"
      [title]="'Delete selected workouts' | translate"
      (click)="bulkDelete()"
    >
      <app-icon name="delete" size="16" />
      <span class="d-none d-sm-inline ms-1">{{ 'Delete' | translate }}</span>
    </button>
  </div>

  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3" filters>
    <div class="col">
      <label class="form-label small text-muted" for="filter-type">{{ 'Type' | translate }}</label>
      <select
        class="form-select form-select-sm"
        id="filter-type"
        [value]="filterState().type"
        (change)="onWorkoutTypeFilterChange($any($event.target).value)"
      >
        <option value="">{{ 'All' | translate }}</option>
        @for (type of workoutTypes; track type.value) {
          <option [value]="type.value">{{ sportLabel(type.value) | translate }}</option>
        }
      </select>
    </div>
    <div class="col">
      <label class="form-label small text-muted" for="filter-since">{{ 'Since' | translate }}</label>
      <select
        class="form-select form-select-sm"
        id="filter-since"
        [value]="filterState().since"
        (change)="onWorkoutSinceFilterChange($any($event.target).value)"
      >
        @for (option of sinceOptions; track option.value) {
          <option [value]="option.value">{{ option.label | async }}</option>
        }
      </select>
    </div>
    <div class="col">
      <label class="form-label small text-muted" for="filter-sort-by">{{ 'Sort by' | translate }}</label>
      <div class="d-flex gap-2">
        <select
          class="form-select form-select-sm flex-grow-1"
          id="filter-sort-by"
          [value]="filterState().orderBy"
          (change)="onWorkoutOrderByChange($any($event.target).value)"
        >
          @for (option of orderByOptions; track option.value) {
            <option [value]="option.value">{{ option.label | async }}</option>
          }
        </select>
        <select
          aria-label="{{ 'Sort by' | translate }}"
          class="form-select form-select-sm"
          [value]="filterState().orderDir"
          (change)="onWorkoutOrderDirChange($any($event.target).value)"
        >
          @for (option of orderDirOptions; track option.value) {
            <option [value]="option.value">{{ option.label | async }}</option>
          }
        </select>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div table>
    <app-base-table
      [getRowLink]="getWorkoutLink"
      [items]="workouts()"
      [multiSelectActive]="isMultiSelectActive()"
      [selectedItems]="baseList().selectedItems()"
      (selectionToggled)="toggleItemSelection($event)"
    >
      <!-- Table header -->
      <ng-template #tableHeader>
        <th>{{ 'Type' | translate }}</th>
        <th>{{ 'Name' | translate }}</th>
        <th>{{ 'Date' | translate }}</th>
        <th>{{ 'Distance' | translate }}</th>
        <th>{{ 'Duration' | translate }}</th>
        @if (sortedColumnMeta()) {
          <th class="text-end">{{ sortedColumnMeta()?.label | async }}</th>
        }
        <th class="d-none d-md-table-cell">{{ 'Average speed' | translate }}</th>
        <th class="text-end d-none d-lg-table-cell">{{ 'Actions' | translate }}</th>
      </ng-template>

      <!-- Table row -->
      <ng-template #tableRow let-getRowLink="getRowLink" let-multiSelectActive="multiSelectActive" let-onCellClick="onCellClick" let-workout>
        <td class="position-relative" (click)="multiSelectActive && toggleItemSelection(workout.id)">
          @if (!multiSelectActive) {
            <!-- eslint-disable-next-line @angular-eslint/template/elements-content -->
            <a class="cell-link-backdrop" [routerLink]="getRowLink(workout)"></a>
          }
          <div class="cell-content">
            <app-icon size="24" [name]="workout.type" />
          </div>
        </td>
        <td class="position-relative" (click)="multiSelectActive && toggleItemSelection(workout.id)">
          @if (!multiSelectActive) {
            <!-- eslint-disable-next-line @angular-eslint/template/elements-content -->
            <a class="cell-link-backdrop" [routerLink]="getRowLink(workout)"></a>
          }
          <div class="cell-content">
            <strong>{{ workout.name }}</strong>
            @if (workout.locked) {
              <span class="badge bg-warning text-dark">
                <app-icon name="locked" size="12" />
              </span>
            }
            @if (workout.dirty) {
              <span class="badge bg-info text-dark">
                <app-icon name="refresh" size="12" />
              </span>
            }
            <br />
            <small class="text-muted">{{ sportLabel(workout.type) | translate }}</small>
          </div>
        </td>
        <td class="position-relative" (click)="multiSelectActive && toggleItemSelection(workout.id)">
          @if (!multiSelectActive) {
            <!-- eslint-disable-next-line @angular-eslint/template/elements-content -->
            <a class="cell-link-backdrop" [routerLink]="getRowLink(workout)"></a>
          }
          <div class="cell-content">
            {{ formatDate(workout.date) }}
          </div>
        </td>
        <td class="position-relative" (click)="multiSelectActive && toggleItemSelection(workout.id)">
          @if (!multiSelectActive) {
            <!-- eslint-disable-next-line @angular-eslint/template/elements-content -->
            <a class="cell-link-backdrop" [routerLink]="getRowLink(workout)"></a>
          }
          <div class="cell-content">
            @if (workout.total_distance) {
              <strong>{{ formatDistance(workout.total_distance) }}</strong> km
            } @else {
              <span class="text-muted">-</span>
            }
          </div>
        </td>
        <td class="position-relative" (click)="multiSelectActive && toggleItemSelection(workout.id)">
          @if (!multiSelectActive) {
            <!-- eslint-disable-next-line @angular-eslint/template/elements-content -->
            <a class="cell-link-backdrop" [routerLink]="getRowLink(workout)"></a>
          }
          <div class="cell-content">
            @if (workout.total_duration) {
              {{ formatDuration(workout.total_duration) }}
            } @else {
              <span class="text-muted">-</span>
            }
          </div>
        </td>
        @if (sortedColumnMeta()) {
          <td class="position-relative text-end" (click)="multiSelectActive && toggleItemSelection(workout.id)">
            @if (!multiSelectActive) {
              <!-- eslint-disable-next-line @angular-eslint/template/elements-content -->
              <a class="cell-link-backdrop" [routerLink]="getRowLink(workout)"></a>
            }
            <div class="cell-content text-nowrap">
              {{ getSortedColumnValue(workout) }}
            </div>
          </td>
        }
        <td class="d-none d-md-table-cell position-relative" (click)="multiSelectActive && toggleItemSelection(workout.id)">
          @if (!multiSelectActive) {
            <!-- eslint-disable-next-line @angular-eslint/template/elements-content -->
            <a class="cell-link-backdrop" [routerLink]="getRowLink(workout)"></a>
          }
          <div class="cell-content">
            @if (workout.average_speed) {
              {{ (workout.average_speed * 3.6).toFixed(2) }} km/h
            } @else {
              <span class="text-muted">-</span>
            }
          </div>
        </td>
        <td class="text-end d-none d-lg-table-cell">
          <app-workout-list-actions
            [workout]="workout"
            (workoutDeleted)="onWorkoutDeleted(workout.id)"
            (workoutUpdated)="onWorkoutUpdated($event)"
          />
        </td>
      </ng-template>
    </app-base-table>
  </div>
</app-base-list>
