<div class="container my-5">
  @if (loading()) {
    <div class="text-center">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">{{ 'statistics.loading' | translate }}</span>
      </div>
    </div>
  }

  @if (error()) {
    <div class="alert alert-danger" role="alert">
      {{ error() }}
    </div>
  }

  @if (!loading() && !error() && workout()) {
    <div class="workout-header mb-4">
      <h1 class="display-4 mb-0">
        <app-icon size="32" [name]="workout()!.type" />
        {{ workout()!.name }}
      </h1>
      @if (workout()!.locked) {
        <span class="badge bg-warning">
          <app-icon name="locked" size="16" />
          Locked
        </span>
      }
    </div>

    <div class="workout-info mb-4">
      <div class="row">
        <div class="col-md-3">
          <strong>{{ 'workout.date' | translate }}</strong>
          <p>{{ workout()!.date | date: 'medium' }}</p>
        </div>
        @if (workout()!.total_distance) {
          <div class="col-md-3">
            <strong>{{ 'dashboard.distance' | translate }}</strong>
            <p>{{ (workout()!.total_distance! / 1000).toFixed(2) }} km</p>
          </div>
        }
        @if (workout()!.total_duration) {
          <div class="col-md-3">
            <strong>{{ 'dashboard.duration' | translate }}</strong>
            <p>{{ formatDuration(workout()!.total_duration!) }}</p>
          </div>
        }
        @if (workout()!.average_speed) {
          <div class="col-md-3">
            <strong>{{ 'dashboard.average_speed' | translate }}</strong>
            <p>{{ (workout()!.average_speed! * 3.6).toFixed(2) }} km/h</p>
          </div>
        }
      </div>
    </div>

    @if (hasMapData()) {
      <div class="mb-4">
        <app-workout-map
          [center]="workout()!.map_data!.center"
          [mapData]="workout()!.map_data!.details"
        />
      </div>

      <div class="mb-4">
        <app-workout-chart
          [extraMetrics]="workout()!.map_data!.extra_metrics || []"
          [mapData]="workout()!.map_data!.details"
        />
      </div>
    }

    <div class="mb-4">
      <app-workout-breakdown
        [extraMetrics]="workout()!.map_data?.extra_metrics || []"
        [mapData]="workout()!.map_data?.details"
      />
    </div>

    @if (workout()!.notes) {
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">{{ 'equipment.notes' | translate }}</h5>
        </div>
        <div class="card-body">
          <p class="mb-0">{{ workout()!.notes }}</p>
        </div>
      </div>
    }

    <div class="alert alert-info mt-4">
      <!-- Public workout notice (translated below) -->
      <p class="mb-0">
        <span>{{ 'workout.public_workout_notice_part1' | translate }}</span>
        <a routerLink="/login">{{ 'auth.sign_in' | translate }}</a>
        <span>{{ 'workout.public_workout_notice_part2' | translate }}</span>
        <a routerLink="/register">{{ 'auth.register' | translate }}</a>
        <span>{{ 'workout.public_workout_notice_part3' | translate }}</span>
      </p>
    </div>
  }
</div>
