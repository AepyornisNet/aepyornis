<div class="container my-5">
  <h1 class="display-4 mb-3">
    <app-icon name="statistics" size="32" />
    {{ 'Statistics' | translate }}
  </h1>

  <app-statistics-nav />

  <div class="card mb-4">
    <div class="card-body">
      <form class="row g-3" [formGroup]="filterForm" (ngSubmit)="onFilterChange()">
        <div class="col-md-4">
          <label class="form-label" for="since">{{ 'Since' | translate }}</label>
          <select
            class="form-select"
            formControlName="since"
            id="since"
            (change)="onFilterChange()"
          >
            @for (option of sinceOptions; track option.key) {
              <option [value]="option.key">{{ option.label | async }}</option>
            }
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label" for="per">{{ 'Per' | translate }}</label>
          <select class="form-select" formControlName="per" id="per" (change)="onFilterChange()">
            @for (option of perOptions; track option.key) {
              <option [value]="option.key">{{ option.label | async }}</option>
            }
          </select>
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button class="btn btn-primary" type="submit" [disabled]="filterForm.invalid">
            {{ 'Refresh' | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>

  @if (loading()) {
    <div class="text-center my-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">{{ 'Loading' | translate }}</span>
      </div>
    </div>
  }

  @if (error()) {
    <div class="alert alert-danger" role="alert">
      {{ error() }}
    </div>
  }

  @if (!loading() && statistics()) {
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h3 class="card-title">
              <app-icon name="workout" />
              {{ 'Workouts' | translate }}
            </h3>
            <app-statistic-chart
              [preferredUnits]="preferredUnits() || undefined"
              [stats]="statistics()"
              [type]="'workouts'"
            />
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h3 class="card-title">
              <app-icon name="duration" />
              {{ 'Duration' | translate }}
            </h3>
            <app-statistic-chart
              [filterNoDuration]="true"
              [preferredUnits]="preferredUnits() || undefined"
              [stats]="statistics()"
              [type]="'duration_seconds'"
              [unit]="'duration'"
            />
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h3 class="card-title">
              <app-icon name="distance" />
              {{ 'Distance' | translate }}
            </h3>
            <app-statistic-chart
              [filterNoDuration]="true"
              [preferredUnits]="preferredUnits() || undefined"
              [stats]="statistics()"
              [type]="'distance'"
              [unit]="'distance'"
            />
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h3 class="card-title">
              <app-icon name="speed" />
              {{ 'Average speed' | translate }}
            </h3>
            <app-statistic-chart
              [filterNoDuration]="true"
              [preferredUnits]="preferredUnits() || undefined"
              [stats]="statistics()"
              [type]="'average_speed'"
              [unit]="'speed'"
            />
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h3 class="card-title">
              <app-icon name="speed" />
              Average Speed (No Pause)
            </h3>
            <app-statistic-chart
              [filterNoDuration]="true"
              [preferredUnits]="preferredUnits() || undefined"
              [stats]="statistics()"
              [type]="'average_speed_no_pause'"
              [unit]="'speed'"
            />
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card">
          <div class="card-body">
            <h3 class="card-title">
              <app-icon name="max-speed" />
              Max Speed
            </h3>
            <app-statistic-chart
              [filterNoDuration]="true"
              [preferredUnits]="preferredUnits() || undefined"
              [stats]="statistics()"
              [type]="'max_speed'"
              [unit]="'speed'"
            />
          </div>
        </div>
      </div>
    </div>
  }
</div>
