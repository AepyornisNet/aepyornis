<div class="container my-5">
  @if (loading()) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">{{ 'Loading' | translate }}</span>
      </div>
    </div>
  }

  @if (error()) {
    <div class="alert alert-danger" role="alert">
      {{ error() }}
    </div>
  }

  @if (!loading() && equipment()) {
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <button class="btn btn-link p-0 mb-2" (click)="goBack()">
          <app-icon name="back" size="20" />
          <span>{{ 'Back To Equipment' | translate }}</span>
        </button>
        <h1 class="display-4 mb-0">{{ equipment()!.name }}</h1>
        @if (equipment()!.active) {
          <span class="badge bg-success">{{ 'Active' | translate }}</span>
        } @else {
          <span class="badge bg-secondary">{{ 'Inactive' | translate }}</span>
        }
      </div>
      <div class="btn-group" role="group">
        <button class="btn btn-outline-secondary" (click)="openEditModal()">
          {{ 'Edit' | translate }}
        </button>
        <button class="btn btn-outline-danger" (click)="openDeleteModal()">
          {{ 'Delete' | translate }}
        </button>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-6">
        <!-- Equipment Details Card -->
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <h5 class="card-title mb-3">{{ 'Details' | translate }}</h5>
            <table class="table table-sm">
              <tbody>
                <tr>
                  <th style="width: 40%">{{ 'Name' | translate }}</th>
                  <td>{{ equipment()!.name }}</td>
                </tr>
                <tr>
                  <th>{{ 'Created' | translate }}</th>
                  <td>{{ formatDate(equipment()!.created_at) }}</td>
                </tr>
                <tr>
                  <th>{{ 'Last updated' | translate }}</th>
                  <td>{{ formatDate(equipment()!.updated_at) }}</td>
                </tr>
                <tr>
                  <th>{{ 'Active' | translate }}</th>
                  <td>
                    @if (equipment()!.active) {
                      <span class="text-success">{{ 'Yes' | translate }}</span>
                    } @else {
                      <span class="text-secondary">{{ 'No' | translate }}</span>
                    }
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Description Card -->
        @if (equipment()!.description) {
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">{{ 'Description' | translate }}</h5>
              <p class="card-text">{{ equipment()!.description }}</p>
            </div>
          </div>
        }

        <!-- Notes Card -->
        @if (equipment()!.notes) {
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">{{ 'Notes' | translate }}</h5>
              <div class="card-text" style="white-space: pre-wrap">{{ equipment()!.notes }}</div>
            </div>
          </div>
        }

        <!-- Default Workout Types -->
        @if (equipment()!.default_for && equipment()!.default_for!.length > 0) {
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <h5 class="card-title mb-3">
                {{ 'Default For Workout Types' | translate }}
              </h5>
              <div class="d-flex flex-wrap gap-2">
                @for (type of equipment()!.default_for!; track type) {
                  <span class="badge bg-primary">{{ type }}</span>
                }
              </div>
            </div>
          </div>
        }
      </div>

      <div class="col-lg-6">
        <!-- Placeholder for workouts or stats -->
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <h5 class="card-title mb-3">{{ 'Usage Statistics' | translate }}</h5>
            <p class="text-muted">
              {{
                'Workout history and statistics will be displayed here in a future update.'
                  | translate
              }}
            </p>
          </div>
        </div>
      </div>
    </div>
  }
</div>

<!-- Edit Modal -->
@if (showEditModal()) {
  <div class="modal fade show d-block" style="background-color: rgba(0, 0, 0, 0.5)" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ 'Edit Equipment' | translate }}</h5>
          <button
            aria-label="Close"
            class="btn-close"
            type="button"
            (click)="closeEditModal()"
          ></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label" for="edit-name">{{ 'Name' | translate }}</label>
            <input
              class="form-control"
              id="edit-name"
              type="text"
              [value]="equipmentForm().name"
              (input)="updateFormName($any($event.target).value)"
            />
          </div>
          <div class="mb-3">
            <label class="form-label" for="edit-description">{{
              'Description' | translate
            }}</label>
            <textarea
              class="form-control"
              id="edit-description"
              rows="3"
              [value]="equipmentForm().description"
              (input)="updateFormDescription($any($event.target).value)"
            ></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label" for="edit-notes">{{ 'Notes' | translate }}</label>
            <textarea
              class="form-control"
              id="edit-notes"
              rows="5"
              [value]="equipmentForm().notes"
              (input)="updateFormNotes($any($event.target).value)"
            ></textarea>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              id="edit-active"
              type="checkbox"
              [checked]="equipmentForm().active"
              (change)="updateFormActive($any($event.target).checked)"
            />
            <label class="form-check-label" for="edit-active">
              {{ 'Active' | translate }}
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="closeEditModal()">
            {{ 'Cancel' | translate }}
          </button>
          <button class="btn btn-primary" type="button" (click)="updateEquipment()">
            {{ 'Update' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Delete Modal -->
@if (showDeleteModal() && equipment()) {
  <div class="modal fade show d-block" style="background-color: rgba(0, 0, 0, 0.5)" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ 'Delete Equipment' | translate }}</h5>
          <button
            aria-label="Close"
            class="btn-close"
            type="button"
            (click)="closeDeleteModal()"
          ></button>
        </div>
        <div class="modal-body">
          <p>{{ 'Are You Sure You Want To Delete This Equipment' | translate }}</p>
          <p>
            <strong>{{ equipment()!.name }}</strong>
          </p>
          <p class="text-danger">{{ 'This Action Cannot Be Undone' | translate }}</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="closeDeleteModal()">
            {{ 'Cancel' | translate }}
          </button>
          <button class="btn btn-danger" type="button" (click)="deleteEquipment()">
            {{ 'Delete' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
}
