#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

// Simple YAML parser for our specific format
function parseYaml(content) {
  const lines = content.split('\n');
  const workoutTypes = [];
  let currentType = null;

  for (const line of lines) {
    const trimmed = line.trim();
    if (trimmed.startsWith('- name:')) {
      if (currentType) {
        workoutTypes.push(currentType);
      }
      currentType = {
        name: trimmed.split(':')[1].trim(),
        location: false,
        distance: false,
        repetition: false,
        weight: false,
      };
    } else if (currentType) {
      if (trimmed.startsWith('location:')) {
        currentType.location = trimmed.split(':')[1].trim() === 'true';
      } else if (trimmed.startsWith('distance:')) {
        currentType.distance = trimmed.split(':')[1].trim() === 'true';
      } else if (trimmed.startsWith('repetition:')) {
        currentType.repetition = trimmed.split(':')[1].trim() === 'true';
      } else if (trimmed.startsWith('weight:')) {
        currentType.weight = trimmed.split(':')[1].trim() === 'true';
      }
    }
  }
  
  if (currentType) {
    workoutTypes.push(currentType);
  }

  return workoutTypes;
}

// Read the YAML file
const yamlPath = path.join(__dirname, '..', 'workout-types.yaml');
const yamlContent = fs.readFileSync(yamlPath, 'utf8');
const workoutTypes = parseYaml(yamlContent);

// Generate TypeScript code
const tsCode = `// Code generated by generate-workout-types.js; DO NOT EDIT.

/**
 * Workout types and configuration
 */

export interface WorkoutTypeConfig {
  value: string;
  location: boolean;
  distance: boolean;
  repetition: boolean;
  weight: boolean;
  duration: boolean;
}

export const WORKOUT_TYPES: WorkoutTypeConfig[] = [
${workoutTypes.map(wt => `  { value: '${wt.name}', location: ${wt.location}, distance: ${wt.distance}, repetition: ${wt.repetition}, weight: ${wt.weight}, duration: true }`).join(',\n')}
];

export function getWorkoutTypeConfig(type: string): WorkoutTypeConfig | undefined {
  return WORKOUT_TYPES.find(wt => wt.value === type);
}
`;

// Write the TypeScript file
const outputPath = path.join(__dirname, '..', 'client', 'src', 'app', 'core', 'types', 'workout-types.ts');
fs.writeFileSync(outputPath, tsCode, 'utf8');

console.log('Generated workout-types.ts successfully');
